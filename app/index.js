const express = require('express');
const morgan = require('morgan');
const cors = require('cors');

const app = express();
const PORT = process.env.PORT || 3000;

// imports
const db_setup_router = require('./setup_controller');
const vulnerable_router = require('./vulnerable_controller');
const secure_router = require('./secure_controller');

//
// Middlewares 
// 
app.use(cors());
app.use(morgan('dev'));
app.use(express.json()); // para parsear las peticiones | BodyParser

// API routes
app.use('/setup', db_setup_router);
app.use('/vulnerable', vulnerable_router);
app.use('/secure', secure_router)


// Status
app.get('/', (req, res) => {
    res.status(200).json({ "status": 'Node.js express REST API for SQLi is up and running!!!' })
})

// 
console.log(`PostgreSQL mapped user: ${process.env.PGUSER}`);
console.log(`PostgreSQL mapped password: ${process.env.PGPASSWORD}`);
console.log(`PostgreSQL mapped db: ${process.env.PGDB}`);
console.log(`PostgreSQL mapped host: ${process.env.PGHOST}`);

// Start the server
app.listen(PORT, () => {
    console.log(`Server listening on port ${PORT}`)
});